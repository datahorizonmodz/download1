<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raw Text to Product Converter</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --bg: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --border: #e2e8f0;
            --success: #22c55e;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--surface);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        .subtitle {
            text-align: center;
            color: #64748b;
            margin-bottom: 30px;
            font-size: 0.9rem;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
        }

        textarea {
            width: 100%;
            height: 350px;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn-container {
            grid-column: 1 / -1;
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background-color: var(--primary-hover);
        }

        button.secondary {
            background-color: #64748b;
        }
        
        button.secondary:hover {
            background-color: #475569;
        }

        .output-box {
            background: #f1f5f9;
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            height: 350px;
            overflow-y: auto;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            font-size: 14px;
        }

        .tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .tag.name { background: #dbeafe; color: #1e40af; }
        .tag.price { background: #dcfce7; color: #166534; }
        .tag.note { background: #fee2e2; color: #991b1b; }

        /* Highlight helper in output explanation */
        .section-header {
            font-weight: bold;
            color: var(--primary);
            margin-top: 10px;
            border-bottom: 1px solid #ddd;
            display: block;
        }

    </style>
</head>
<body>

<div class="container">
    <h1>Text-to-Product Converter</h1>
    <p class="subtitle">Convert messy WhatsApp/Telegram lists into clean store data.</p>

    <div class="grid">
        <div>
            <label for="rawInput">Paste Raw Text Here:</label>
            <textarea id="rawInput" placeholder="Example:
CHATGPT
- sharing 5u 1b : 7.000
- gpt go 1 tahun : 10.000 (nogar)

â“˜ order wajib sabar"></textarea>
        </div>

        <div>
            <label for="cleanOutput">Clean Output Result:</label>
            <div id="cleanOutput" class="output-box" contenteditable="true"></div>
        </div>
    </div>

    <div class="btn-container">
        <button onclick="convertText()">âš¡ Convert Text</button>
        <button class="secondary" onclick="copyOutput()">ðŸ“‹ Copy Output</button>
    </div>
</div>

<script>
    // --- MAIN CONVERSION LOGIC ---

    function convertText() {
        const rawText = document.getElementById('rawInput').value;
        const outputDiv = document.getElementById('cleanOutput');
        
        if (!rawText.trim()) {
            outputDiv.innerHTML = '<span style="color:#888">Please paste text to convert...</span>';
            return;
        }

        const lines = rawText.split('\n');
        let productName = "";
        let processedVariants = [];
        let importantNotes = [];

        // 1. First Pass: Detect Product Name & Separate Notes
        // We look for the first non-empty line that DOES NOT have a price logic
        // to be the Product Name.
        
        for (let i = 0; i < lines.length; i++) {
            let line = lines[i].trim();
            if (!line) continue;

            // Remove emojis for analysis
            const cleanLine = removeEmojis(line);
            
            // Check for Notes indicators
            if (line.match(/^[â“˜âš !]/) || line.toLowerCase().startsWith('note') || line.toLowerCase().includes('wajib')) {
                // Clean the note line
                let noteText = cleanLine.replace(/^[â“˜âš !\-]\s*/, '').trim();
                if(noteText) importantNotes.push(noteText);
                continue;
            }

            // Check if line is a price variant (contains numbers resembling price)
            // Regex looks for digits at end of line or after colon
            const hasPrice = /(\d{1,3}[.,]\d{3})|\s\d{4,}\s|:\s*\d+/.test(line);

            if (!hasPrice && !productName && cleanLine.length > 2) {
                // If it's not a price line and we don't have a name yet, this is the Header/Name
                productName = toTitleCase(cleanLine.replace(/[^\w\s]/gi, '').trim());
            } else if (hasPrice) {
                // This is a product variant line, process it
                const variant = processVariantLine(line, productName);
                if (variant) processedVariants.push(variant);
            }
        }

        // --- RENDER OUTPUT ---
        let finalHTML = "";

        if (productName) {
            finalHTML += `<span class="section-header">Product Name:</span>\n${productName}\n\n`;
        }

        if (processedVariants.length > 0) {
            finalHTML += `<span class="section-header">Price Options:</span>\n`;
            processedVariants.forEach(v => {
                finalHTML += `- ${v.fullString} | Price: ${v.price} ${v.warranty ? '(' + v.warranty + ')' : ''}\n`;
            });
            finalHTML += "\n";
        }

        if (importantNotes.length > 0) {
            finalHTML += `<span class="section-header">Important Notes:</span>\n`;
            importantNotes.forEach(note => {
                finalHTML += `- ${note}\n`;
            });
        }

        outputDiv.innerHTML = finalHTML;
    }

    // --- HELPER FUNCTIONS ---

    function processVariantLine(line, mainProductName) {
        // 1. Clean noise
        let text = removeEmojis(line);
        text = text.replace(/^[-â€¢*]\s*/, ''); // remove bullet points

        // 2. Extract Price
        // Look for price pattern: 10.000, 7000, 5,500
        // Usually at the end or after ':'
        let price = "0";
        let priceMatch = text.match(/:\s*(\d{1,3}(?:[.,]\d{3})*)/) || text.match(/(\d{1,3}(?:[.,]\d{3})*)\s*$/);
        
        if (priceMatch) {
            // Remove delimiters from price to make it pure numeric
            price = priceMatch[1].replace(/[.,]/g, '');
            // Remove the price from the text string so we don't parse it as user/duration
            text = text.replace(priceMatch[0], ''); 
        }

        // 3. Extract Warranty (Optional)
        let warranty = "";
        if (text.toLowerCase().includes('nogar') || text.toLowerCase().includes('no gar')) {
            warranty = "No Warranty";
        } else if (text.toLowerCase().includes('fullgar') || text.toLowerCase().includes('full gar')) {
            warranty = "Full Warranty";
        }
        // Remove warranty text
        text = text.replace(/\((nogar|fullgar|no gar|full gar)\)/ig, '');

        // 4. Extract Duration (Strict)
        // Maps: 1b->1 Bulan, 7d->7 Hari, 1th->1 Tahun
        let duration = "";
        
        const durationPatterns = [
            { regex: /(\d+)\s?(d|h|hr|hari|day|days)\b/i, label: "Hari" },
            { regex: /(\d+)\s?(b|bln|bulan|month|months)\b/i, label: "Bulan" },
            { regex: /(\d+)\s?(t|th|thn|tahun|year|years)\b/i, label: "Tahun" },
            { regex: /(\d+)\s?(minggu|week|weeks)\b/i, label: "Minggu" }
        ];

        for (let pat of durationPatterns) {
            let match = text.match(pat.regex);
            if (match) {
                duration = `${match[1]} ${pat.label}`;
                text = text.replace(match[0], ''); // remove found duration
                break; 
            }
        }

        // 5. Extract Users (Optional)
        // 5u, 5 user, 5 device
        let userCount = "";
        const userMatch = text.match(/(\d+)\s?(u|user|users|device|screen)\b/i);
        if (userMatch) {
            userCount = `${userMatch[1]} User`;
            text = text.replace(userMatch[0], '');
        }

        // 6. Extract Type (The leftovers)
        // Cleanup whatever remains to find the "Type" (e.g., Sharing, Private, GPT Go)
        // Remove symbols like ':', '-', '(', ')'
        let type = text.replace(/[:()]/g, '').trim();
        
        // Remove the product name from the type if it was pasted redundantly in the line
        if (mainProductName) {
            const escapeName = mainProductName.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
            const nameRegex = new RegExp(escapeName, 'i');
            type = type.replace(nameRegex, '').trim();
        }
        
        // Final cleanup of Type
        type = type.replace(/\s+/g, ' '); // collapse spaces
        type = toTitleCase(type);

        // 7. Construct Full Name
        // Structure: <Product Name> <Type> <User Info> - <Duration>
        let fullString = mainProductName;
        
        if (type) fullString += ` ${type}`;
        if (userCount) fullString += ` ${userCount}`;
        if (duration) fullString += ` - ${duration}`;

        // Fallback if no duration found (rare but possible)
        if (!duration) {
             // If no duration, maybe it's "Lifetime" or the duration parsing failed.
             // We leave it as is, or you can append text here.
        }

        return {
            fullString: fullString.trim(),
            price: price,
            warranty: warranty
        };
    }

    // Utilities
    function removeEmojis(str) {
        return str.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '').trim();
    }

    function toTitleCase(str) {
        return str.replace(/\w\S*/g, function(txt) {
            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
        });
    }

    function copyOutput() {
        const output = document.getElementById('cleanOutput');
        if (!output.textContent) return;

        // We create a temporary textarea to copy the innerText (which preserves newlines)
        const textarea = document.createElement('textarea');
        textarea.value = output.innerText;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);

        // Visual feedback
        const btn = document.querySelector('button.secondary');
        const originalText = btn.textContent;
        btn.textContent = "âœ… Copied!";
        btn.style.background = "var(--success)";
        setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = "#64748b";
        }, 2000);
    }
</script>

</body>
</html>
